#+latex_HEADER: \usepackage{siunitx}
#+latex_HEADER: \usepackage[version=3]{mhchem}
#+latex_HEADER: \usepackage{mathrsfs}
#+latex_HEADER: \usepackage[export]{adjustbox}
#+latex_HEADER: \usepackage{pgf,tikz}
#+latex_HEADER: \usepackage{wasysym}
#+latex_HEADER: \usetikzlibrary{arrows}
#+LATEX_HEADER: \usepackage[UTF8]{ctex}
#+LaTeX_HEADER: \usepackage{appendixnumberbeamer}
#+PROPERTY: header-args :eval never-export
#+PROPERTY: header-args :noweb yes
#+sTARTUP: beamer

* 价值
  - 工
具
审
美

    学
物
理
的
同
学
亟
需

  - 实
践
性
的
课
程
：
没
有
必
要
记
忆
，
但
一
定
要
在
短
时
间
内
实
践
* Python for everyone -- control flow
** Why do we program?
   - Delegate
repeatative
tasks
   - Record
what
you
did
*** Digital age
    - We
just
buy
device,
use
devices.
      - How
about
we
understanding
devices,
fixing
devices
and
making
        devices?
      - Programming
is
one
important
step.
You
build
your
world,
        change
the
world
and
participate
in
creating
and
nurturing
of
        civilization
by
programming
in
this
age.
      - If
you
don't
know
programming,
someone
else
will
design
your
        world
for
you.
*** Not only a programmer needs to learn program
    - Not
even
a
physicist.
    - Everyone
needs
to
a
bit
of
programming
      - Secretary
      - Sales
champion
      - Accountant
      - Manager
      - Cab
driver
** Why Python?
   - Python
is
a
self-organized
community.
** Python environment
   - Real
GNU/Linux
     + Debian
     + Gentoo
   - Jupyter
based
   - Windows
based

   Windows
based
Python
installation
has
caveats,
because
Python
is
   developed
under
Unix.
Be
prepared
for
unexpected
bugs
if
you
   decide
to
use
Python
on
windows.

   - Can't
or
don't
want
to
install
software
on
your
computer?
Check
     out
PythonAnywhere,
Trinket,
Cloud9,
or
CodeAnywhere.

** Choose an editor
   - Emacs
     https://github.com/redguardtoo/mastering-emacs-in-one-year-guide
   - Vi
   - Others
     - Visual
Studio
Code
     - Atom
   Both
Emacs
and
Vi
have
steep
learning
curves,
they
are
not
easy
to
   learn.
But
if
you
master
any
of
them,
they
pays
you.

   Don't
use
Microsoft
Word
or
Windows
Notepad,
they
are
not
for
   programs.
Because
we
need
an
editor
that
do
plain
text
and
   syntactically
correct.
** Playground
   https://www.py4e.com/tools/pythonauto
   
   Do
we
need
one?
I
don't
think
so.

** Jupyter
   - Causal
way
to
completing
classes.
** Installing Python
   + Windows
     - Not
impossible.
     - No
good
package
manager.
       - ... what
is
package
manager?
       - pip
on
windows
is
a
hack.
     - Snipping
tool.
   + macOS
     - No
good
package
manager.
       - Need
extra
care
when
using
pip,
easy
to
screw
up.
   + GNU/Linux
     - steep
learning
curve.
     - not
everything
is
obvious.
     - pays
you
back
if
you
are
committed
to
deal
with
data
and
       programs:
experimental
physicist,
data
scientist,
quant,
etc.
       That
is
the
main
audience
this
course
is
targeting.
     - I
am
going
to
give
lectures,
examples,
demonstrations
on
       GNU/Linux
with
Emacs.
   + You
can
try
them
if
you
are
brave,
and
you
are
encouraged
to
find
     your
own
work
style.
** Submit screen shots
   - Needed
skill
for
online
discussion.
   - Anonymous
discussion
groups,
piazza
     "Not
good",
commented
by
Harry
   - git
classroom
     https://github.com/CS50Demo/assignment-1-introduction-to-programming-heroxbd-1
** Version control and Git
   - jiegec's
lectures.

   https://cloud.tsinghua.edu.cn/d/f3f13a46ed4c4b5386f9/
** Write paragraphs of code
   - Basic
programming
structures
     - sequential
     - conditinoal
     - iterative
     - recursive
   - Early
exit


*** Further Reading
    - A proof that all reasonable programs can be decoupled into
      combinations of the 3 constructs. ???
    - Structured program theorem
      - Goto statement considered harmful

    - https://en.wikipedia.org/wiki/Structured_programming
    - https://en.wikipedia.org/wiki/Goto#Criticism
** Expressions (including statements)
   - Reserved words.  Not used for anything else.
   - Variable
     - Case sensitive
   - Insane vs letter vs mnemonic
   - Covered in 程序设计基础
     - 设计成练习，作为 git 和 jupyterhub 的熟练练习
   - Keyword is historical
     - **
     - *
     - /
     - %
** How to debug
   - Read error message
   - type()
   - duanzi: 不要用浮点数表示钱——电影 Office Space
     银行用浮点数记账，有误差，被主角用来薅羊毛
** User input
   - 在数据分析中没什么用
** Branching
   - Python 语法的特殊之处
   - 强制缩进: 程序员编辑器非常重要
     - Tab vs space
   - Conditionals: if.. elif..  else
   - Try... except
     - Why can't it be replaced by if.. else?
** Loops and iteration
   - Computers to repetitive task human don't want to do.
   - while loop
   - for loop
   - counting in loop
   - filtering
   - 都作为习惯考察，视同学的基础压缩授课时间
** Types
   - None
** Functions
   - Reuse code

     Dont repeat yourself
   - Function with a return

     consistant with mathematical definition
   - Argument variable
   - 太简单了，引入递归
     
   通过练习保证同学们掌握
* Python for everyone -- data structure
  What python distinguishes itself from C
** String
   - length
   - indexing, slicing
   - Why index starting with 0?
     Dijkstra argument
   - string concatenation, compare with C
     - unicode string
   - in: logical operator
   - string library is a set of toolkit to use
     - dir(str): very useful tools
** 参观科学博物馆 可选
** Files
   - read text files: just use for to loop through.
   - open, close and `with` context
** List
   - List a powerful container.
   - Indexing compared to strings.
   - Append.
   - List and string combo into text parser.
** Dictionary
   - The central data structure of Python.
   - Dictionary: key-value pair
     - As opposed to List: ordered collection
   - Python itself is implemented with namespace and dictionaries.
     - What is a language namespace?
       #+BEGIN_SRC c++
         using namespace std;

         std::stdout
       #+END_SRC
   - Example: word counter.
     - get with a default counter value.
   - 2 iteration looping mode:
     #+BEGIN_SRC python
       for k,v in d.items():
     #+END_SRC
** Tuple
   - Tuple is non-mutable.
   - tuple can be used on the left-side of an assignment statement.
   - List comprehension: beauty of Python.

** 课堂教学，例子
   - 使用邮件库，文本处理
** 参考书
   - Think Python 2e
** 辅助资料
   - https://www.tutorialspoint.com/

     印度的编程样例网站，适合通过例子快速入门一项技能。

   - https://scipy-lectures.org/intro/intro.html

     由 Python 科学计算领域最资深作者亲自执笔编写。
* 用 Python 玩转数据
  http://www.icourse163.org/learn/NJU-1001571005
** Python 入门介绍
   - 主线是 Python 的广泛应用
   - 交互模式和文件执行模式
   - 缩进
   - Python 中的常量
     - stu-name 不是合法的变量名
   - 屏幕书写很适合制作 MOOC
   - 讲课很口语化，在 MOOC 上更有亲和力
** 模块
   - 模块是一个逻辑概念，文件是与之对应的实体概念
** range 迭代器
   好处：用多少就生成多少，甚至可以制作无穷的迭代器。适合大数据应用场景。
* Learn to Program -- The Fundamentals
* 计算机科学和Python编程导论
* Linux 入门基础 - 网易云课堂
  苏勇
  https://study.163.com/course/courseLearn.htm?courseId=232007
** Linux 系统安装
   - VirtualBox
     - 针对运维工作
       - 软件保守，不适合学术
       - 命令行为主，与科学计算很类似
     - 运行在 macOS
   - 使用英语环境
     - 中文的高质量资料很少，中文的社区非常薄弱且小众
     - 英语是程序的天然语言，对科技表达更丰富
     - 世界目前的约定，各国科学家都在通过英语交流
   - 如果立志建设中文社区，请先通过英语学习成为高手
** 命令行界面
   - 与计算机交互的精髓
     - 比随意点选更有助于可复现性
   - 更方便地操作远程的计算资源
** GNOME
   - 有助于渐进地加入命令行
   - 图形界面未必能真切表达人类的意图
   - 图形界面的开发更耗时费力，“易用性”是以开发难度为代价
     - 科学研究更关注本质
** CLI shell, bash / zsh
   - shell 相对于 kernel，在 kernel 之外
   - 用户通过 shell 把命令传给 kernel
   - bash 的提示
   - 命令、选项、参数
     - hostname
     - ls
     - uname
     - clear
     - id
     - passwd
   - 参数：短线、双线，GNU 约定
   - Shell 后台进程
   - Tab 自动补全
     - unique
   - zsh 可以补全参数
   - 上下方向查找历史，Ctrl-r 搜索命令。
     - emacs 快捷键约定
   - ESC-. 上一个命令的选项
   - *, ?, [0-9], {}
   - Ctrl-Z 挂起
     - jobs
     - bg
     - fg
   - 其它命令
     date, uptime, head, tail, less, cat, lspci, zip, tar, find
** 编辑器 vi, emacs
   - Unix 一切都是文本，因为一切皆可用文本编辑器修改。
** 文件系统
   - 目录结构，当前工作目录
   - "."开头的是隐藏文件
   - touch 更新文件时间，不存在则先创建
   - ls -d: list directories themselves, not their contents
   - file 类型
   - 绝对路径、相对路径
     - Linuxcast 图
   - . .. ~ -

   不仔细讲，只做练习
** 文件操作
   - cp, mv, rm, mkdir, rmdir

   不仔细讲，只做练习
** 系统目录 FHS
   - /bin, /sbin
   - /boot
   - /etc
     文本的配置文件
   - /tmp
     临时目录

** 硬盘在系统中的表示
   - /dev/sda, /dev/nvme0
* 实验楼 - Linux 基础入门（新版）
  - 交互式地学习
  - 文件的基本操作
* Data Manipulation at Scale
** Big data
   Any data that is expensive to manage and hard to extract value
   from. - Michael Franklin UC Berkeley

   - 10000 100KB Excel 表格
   - 134万条边，1万个节点的复杂网络

   - Erik Larson, 1989
     - The keepers of big data say that they do it for the consumer's
       benefit. Data have a way of being used for purposes other than
       originally intended.
* GEANT4
  https://groups.lal.in2p3.fr/ED-geant4/ttt/program/

  - 从 Python 起，非常友好的入门。注重可视化。
  - Structure of Geant
    - Run
    - Event
    - Track
    - Step
    - 每天一种，一个可视化的方法
  - Run an application
  - Collect information
  - 只做入门教学，教给同学深入学习的方法
** Introduction
** Geometry
** Primary Paricles
** Physics
** Scoring
* GitHub Classroom
  Use as official homework platform.
** Assignments
   - starter code
   - generate invitation link and distribute
   - Individual assignment, review by pull request
** Skills for the future
   - Teamwork and collaboration
   - Popular industry tools
   - Project management
   - More github features is needed
   - 2-2.5 month to familiar with Github
** alternatives
   - CATSOOP https://catsoop.org/
* 平时作业
  - 细化，标准输入输出
* Berkeley Course
  Data science and Bayesian statistics for physical sciences

  https://data.berkeley.edu/news/new-physics-data-science-course

** Goal
   Modern tools in data science and data analysis in physics.
   
** Audience
   Upper division undergraduates.

** Topic
   - Theoretical, practical, their most common applications in
     physical sciences.
** Grades
   30% projects, 40% homeworks, 30% class participation. 
** Table of contents
   - Numerical integration
   - Introduction to probability and Bayesian inference
   - More on Bayesian inference and intro to data modeling
   - Linear Algebra
   - Information theory
   - Nonlinear equations and 1-d optimization
   - Optimization in many dimensions
   - Monte Carlo methods for integration and posteriors
   - More advanced Bayesian analysis
   - Variational approximations
   - Interpolation and extrapolation of data
   - Fourier methods
   - Ordinary and partial differential equations
   - Classification and inference with machine learning
** Programming environment
   - Jupyter notebook

** Planck 
   A series of tasks
   
   Use measurement of Planck satellite power spectrum to determine
   cosmological parameters.

   - Optimization, find MAP/MLE best fit parameters
   - Determine covariances of all parameters using Laplace approximation.
   - Fisher matrix experiment design predictions.
   - analyze MCMC chains burn-in phase, Gelman-Rubin statistics, and chain
     correlations.
   - Plot 1-d and 2-d distributions and compare them
     to MAP/Laplace approximation.
   - Change one parameter and use importance sampling to produce new
     posteriors.

** LIGO
   Use matched filtering methods and FFT to analyze first LIGO event
   and show it has detected gravitational waves.

** Machine learning on galaxies
   - train the ML algorithms for regression
   - test the training algorithms
   - try KNN, gaussian processes, linear and quadratic regression,
     support vector machines, neural networks, random forest...
   - classification: use galaxy zoo galaxy
     morphology (spirals ellipticals, irregulars...) training dat.
   - Use photometry first, then add image information and observe how
     the accuracy improves.
** grader
   https://okpy.org/
* 公告时间
  1. 小助教申请 7月1日24点截止
  2. 7月2日上午
  3. 大作业替代的提出 7月7日24点载止
* 第一周
  :PROPERTIES:
  :EXPORT_FILE_NAME: w1
  :EXPORT_BEAMER_HEADER+: \title{实验物理的大数据方法}
  :EXPORT_OPTIONS: H:1 num:t toc:nil \n:nil @:t ::t |:t ^:t -:t f:t *:t <:t author:nil
  :EXPORT_OPTIONS: TeX:t LaTeX:t skip:nil d:nil todo:t pri:nil tags:not-in-toc
  :EXPORT_DATE: 2019-07-01 清华
  :EXPORT_BEAMER_HEADER+: \author{续本达}
  :EXPORT_BEAMER_HEADER+: \institute[清华工物]{清华大学 工程物理系}
  :EXPORT_BEAMER_THEME: Boadilla
  :EXPORT_BEAMER_COLOR_THEME: crane
  :EXPORT_BEAMER_FONT_THEME: professionalfonts
  :END:
** 自我介绍
   - 2005-2009 :: 在数理基科学习
   - 2009-2018 :: 在日本神冈地下实验室中微子和暗物质学习，研究
   - 2018-至今 :: 在工程物理系近代物理研究所任教

   - 主要工作：锦屏中微子实验
   - 合作研究
     1. 日本超级神冈实验
     2. 江门中微子实验
     3. 日本XMASS暗物质实验
   - 研究兴趣：中微子振荡、核子衰变、地球中微子
   - 爱好：大数据分析、高性能计算、运维开发(业余)

** 释义
*** 什么是“实验物理”                                         :B_exampleblock:
    :PROPERTIES:
    :BEAMER_env: exampleblock
    :END:
    
    - 一切费电的物理！

      “理论学家费纸，实验学家费电，理论实验物理学家费米”

      - 欧洲核子中心(CERN)一年用电约 \SI{1.3}{\tera\watt\hour}。

        北京东城区西城区2016年用电总量 \SI{10.1}{\tera\watt\hour}，人口 200 万。

    - 观察物理现象的学科
      - 控制物理现象发生的环境？是 \to “实验”(狭义)；否 \to “观测”。
      - 实验物理的目标：发现物理规律，包括测量物理常数。
        
        从取得的数据出发，进行统计推断，证伪物理规律的假设。

*** 什么是“大数据”
    
    是一个商业概念，“大”是相对的，大数据是指无法用一台计算机处理的数据。

** 大物理实验与大数据

   - 大型物理实验，产生大数据，要求多台计算机协同工作：分布式计算。
   - 跨地理的分布式计算称为“网格”(grid)，在早期促进和影响了互联网的发
     展。
     
     - FAST 天眼：每年@@latex:$\SI{\sim 1}{\peta B} = \SI{1e15}{B}$@@。

   - CERN 在 90 年代决定使用 Intel 民用计算机组成的集群来完成 LHC 的计
     算任务，是个人电脑级硬件集群成为科学计算主流的标志。

     - Intel 计算集群是当今大数据工业界的主流配置。

   - 近年来，大数据方法独立于实验物理，被工业界广泛采用，与神经网络结
     合，催生了“深度神经网络”，或“深度学习”。

     - 一系列新方法被应用到实验物理。
** 课程内容
   - 以实验物理为主题，学习大数据方法的基础。
     1. 理解数据的科学精神，从一开始养成良好的科研习惯
     2. 掌握典型工具 Git, Python 和常用命令行工具，适应自学
     3. 培养工具的品位，针对具体场景选择合适的工具

*** 计划安排
    - 实验物理的大数据方法(1) 6A211
      - 第一周 :: Git 入门，Python 入门
      - 第二周 :: Python 科学计算与可视化
    - 实验物理的大数据方法(2) 6A207
      - 第三周 :: 基于命令行的数据处理整合
      - 第四周 :: Python 数据处理高级工具
    - 上课：周一至周四，三四大节
    - 答疑：周五三四大节，地点与上课教室一致
      - Office Hour: 周一至周五晚7点至9点，刘卿楼804
      - 网络学堂“课程答疑”板块
   
** 数据分析的指导原则

   #+attr_beamer: :overlay <+->
   - “复现”原则 :: 以人类语言和计算机语言的形式，详细记录每一步计算。

      这是科学的基本精神，与可证伪性一起，是区分科学与伪科学的标志。

   - “透明”原则 :: 每一步的数据都应尽量可以被人类直接阅读，比如 JSON, CSV。如果不得
      不用二进制模式，一定是使用最普遍最开放的格式，比如 HDF5。

   - “一次”原则 :: Single Point of Truth, Don't Repeat Yourself. 不可在分析做任何
      重复，任何有意义的信息都应该被共享。

   - “最佳工具”原则 :: 尽量使用高级语言和语法糖，为每个子任务选择合适的工具。只有在性能
      分析之后，才在必要时使用低级语言进行性能加速。

      最佳工具会随时间变化，因此课程名不是

      +Python 数据处理与科学计算+

** 课程评估 分数标准
   按百分制记分，录入成绩时转换为等级。

*** 平时作业
    - 占 70% 成绩，覆盖课堂学习的知识要点，以 Github Classroom 形式组
      织。
      - 平时作业中的 80% 为黑盒测试，20% 为白盒测试。
      - 白盒测试重点考察
        1. Git commit 的内容必须有意义。
        2. 程序书写规范

*** 大作业
    - 占 30% 成绩，取材自实验物理不同方向的真实场景。也可以由同学自行
      提出。
      - 分两个阶段，对应前两周和后两周。
** 大作业

   - 课赛结合 中微子实验数据分析
     - 分析中微子实验中，光电倍增管采集的光电子。
     - https://ghost-hunter.net9.org/
   - Tola 微波干涉阵信源定位
     - 通过微波干涉阵的信号，对信源进行定位。
   - 二维金属材料的 Fermi 面测量
     - 通过扫描隧道显微镜的数据，分析二维金属的 Fermi 面。

*** 自定义                                                   :B_exampleblock:
    :PROPERTIES:
    :BEAMER_env: exampleblock
    :END:

    - 如果有同学希望采用其它学科方向的大作业，请提出申请给续本达<orv@tsinghua.edu.cn>
      1. 问题描述和学科背景
      2. 数据的输入和输出的定义与格式
      3. 数据分析结果的评价标准
** 参考资料

   - Allen Downey, Think Python 2e
   - Fernando Perez et al., Scipy Lecture Notes
   - Jeroen Janssens, Data Science at the Command Line
   - David MacKay, Information Theory, Inference, and Learning Algorithms

*** 辅助资料
    - Eric S. Raymond, The Art of Unix Programming
      
      以道家思想剖析了设计的优美和永恒， _透明_ 原则源于此。

    - https://www.tutorialspoint.com/

      印度的编程样例网站，适合通过例子快速入门一项技能。

    - http://py4e.com/

      Python for everybody，全球知名的 Python 教程，新手友好。

    - 苏勇, [[https://study.163.com/course/courseLearn.htm?courseId=232007][Linux 入门基础 - 网易云课堂]]
      
      通过 GNU/Linux 讲授 POSIX 环境基础。内容稍旧，思想不变。

** 教学团队
   - 教师 :: 续本达
   - 助教 :: 陈嘉杰、张爱强、陈晟祺
   - 顾问 :: 郝镇齐、唐如麟、张宗煜、付祈安、高一川、刘晓义
   - 小助教 :: 已经有4位同学自荐，请大家继续踊跃报名，请发邮件至 续本达
            <orv@tsinghua.edu.cn>

     1. 已修过的《程序设计基础》或类似课程的课程号、任课教师与成绩
     2. 是否有中学生信息学竞赛 (OI) 、大学生 ACM 竞赛或类似竞赛的参加经历
     3. 小助教宣言
** Python
   
   #+attr_beamer: :overlay <+->
   - Python 是一门“解释型语言”，相对于“编译型语言”更易调试。
   - Python 的语法风格简明，即使对外行也易读。
     - 书写效率高，快速写出不错的程序。
   - Python 可以直接调用 Fortran, C/C++, R 等语言库，因此也叫“胶水”语
     言，即把不同的程序粘合在一起。
     - 易于与已有工具整合。
     - 促进团队分工，协作。
     - 大大丰富了 Python 生态系统的功能，进一步优化程序运行效率。
     - 符合 _最佳工具_ 原则。
   - Python 是一个通用语言，不仅在科学研究，在生活中的方方面面都会有用。

   - 在科学计算领域得到广泛欢迎和采用。

     https://www.python.org/
** POSIX 环境
   POSIX 是 /Portable Operating System Interface/ 的缩写，是关于计算机
   操作系统的国际标准。它规定了操作系统的基本工具和程序接口。

   - 科学研究中时间和空间跨度都很大，需要使用公开的国际标准化接口，才
     能满足 _复现_ ， _透明_ 和 _最佳工具_ 原则。

*** 满足 POSIX 标准的操作系统
   - GNU/Linux
   - Apple macOS
   - 其它类 Unix 系统
   - Microsoft Windows 本身不满足，但可以使用以下扩展:
     1. Cygwin, MinGW
     2. Windows Subsystem for Linux (WSL)
     3. 使用虚拟机安装 GNU/Linux

** 实践：安装 Python 3 和 POSIX 环境
   - GNU/Linux 用户 :: 工具都已齐备。请帮助周围的同学，并自荐成为小助教
   - Apple macOS 用户 :: Macports, Gentoo Prefix, Homebrew 皆可
   - Microsoft Windows 用户 :: 请注意不要使用带空格的或中文用户名。按
        照以下顺序尝试，直到成功获得 Python 和 POSIX 环境：
     1. Windows Subsystem for Linux (WSL)
     2. MinGW, Cygwin
     3. 使用虚拟机安装 GNU/Linux

** 版本控制
   - “我和同学合写文章，结果他是在昨天的版本上改的！我还得重改！”
*** 发展历史

    #+attr_beamer: :overlay <+->
    - 石器时代 :: =实验报告-v1=, =实验报告-v2=, =实验报告-v2.2=, =实验报告-v2.2-续本达更新20190629= ……
    - 青铜时代 :: diff, patch 文本差分算法
      #+BEGIN_SRC dot :file ./diff-patch.pdf :cmdline -Kdot -Tpdf
        digraph dataset {
        bgcolor="#ffffff00"

        { rank = same; B D1 }
        { rank = same; D2 M }

        B [label = "公共版本"]
        D1 [label = "差分1"]
        D2 [label = "差分2"]
        M [label = "合并"]

        B -> D1 [label = "更新第二章"]
        B -> D2 [label = "修改第一章"]

        D1 -> M [label = "修改第一章"]
        D2 -> M [label = "更新第二章"]
        }
      #+END_SRC

      #+Attr_LaTeX: :height 0.35\textheight
      #+RESULTS:
      [[file:./diff-patch.pdf]]
    - 铁器时代 :: 版本控制服务：CVS，SVN
    - 现代 :: 分布式版本控制：Git，Mercurial
** Git 案例
   “我上周写的程序被不小心覆盖掉了！无法找回之前的版本。”

   #+attr_beamer: :overlay <+->
   - 小强同学经过认真思考和试验，发明了一种巧妙的解决问题方法，并写成
     程序，经验证效果拔群。
     - 小强非常振奋，他把成果记了下来，并继续重构并优化解法。
     - 两个星期之后，他的优化并没有达到预期效果，反而使结果变差。
     - 令他更为懊恼的是，他已经无法达到自己两周之前的高度了，因为忘记
       了改之前的程序是怎么写的。
   - _复现_ 原则被破坏。
   - =解法-20190530.backup= ， =解法-20190608= ？重复存储， _一次_ 原则被破坏。
   - 使用 Git，养成良好的习惯，就能解决以上问题。
   - Git 由 Linus Torvalds 发明，用来支撑全世界 5000 名以上 Linux 操作
     系统内核开发者的协作。是我们的 _最佳工具_ 。
** Git 基础
   [[./fig/pro-git_snapshots.png]]
   - 在任意时间我们都可以选择给工作区进行一次“快照”。
   - 相邻快照之间，是代表文件改动的差分量。
   - 例子：讲义
** 例子：撰写讲义
   [[./fig/tig-example.png]]
   - 查看每次提交的改动。
** Git 三种状态
   - 已提交（committed） :: 改动安全保存在数据库中
   - 已修改（modified） :: 自上一次提交，有文件被修改
   - 已暂存（staged） :: 已修改的文件被作了标记，将被包含在下一轮提交中

      [[./fig/git-modes.png]]              
** Git 仓库间通信
   #+Attr_LaTeX: :height 0.7\textheight
   [[./fig/git-distributed.png]]

   - 建议：通过 SSH (secure shell) 通信。

** Git 基本命令
   #+attr_beamer: :overlay <+->
   - diff :: 查看改动
   - status :: 查看状态
   - add :: 添加文件
   - commit :: 提交
   - log :: 查看历史
   - pull :: 从远程下载
   - push :: 推送到远程

*** 内建手册 =man=                                           :B_exampleblock:
    :PROPERTIES:
    :BEAMER_env: exampleblock
    :END:

    命令的具体含义可以参考 =man= 命令，例如，
   
    #+BEGIN_EXAMPLE
$ man git add
    #+END_EXAMPLE
** 作业：Git 练习
   #+attr_beamer: :overlay <+->
   - [[https://classroom.github.com/a/gxRgrL8_]]
     - 点击后会自动创建你的 Git 仓库

   - 设置本地到 Github 的访问权限
     - 生成 SSH 密钥对
     - 上传到 Github

   - 同步你的 Git 仓库，输入你的基本信息
     #+BEGIN_EXAMPLE
我的姓名：
我的学号：
我的 Python 版本信息：

课程感言：
     #+END_EXAMPLE
   - 查看修改 (diff)
   - 预估得分
   - 添加修改 (add)
   - 提交 (commit)
   - 推送 (push)
** 练习（不记分）：查看备课历史

   - https://github.com/heroxbd/physics-data

     #+BEGIN_SRC bash
git clone git@github.com:heroxbd/physics-data.git
git log -p
     #+END_SRC
** 今日新闻 G20
   #+Attr_LaTeX: :height 0.5\textheight
   [[./fig/news-G20-2019.jpg]]

   - 国家主席习近平6月29日同美国总统特朗普在大阪举行会晤，就当前中美经贸
     摩擦以及共同关心的国际和地区问题深入交换意见……

   - 特朗普政府的政策对中美关系产生深远影响。同时，2016年美国大选中的
     一次重要转折，对特朗普的竞选影响极大。

* 第一周第二天
  :PROPERTIES:
  :EXPORT_FILE_NAME: w1-2
  :EXPORT_BEAMER_HEADER+: \title{实验物理的大数据方法}
  :EXPORT_OPTIONS: H:1 num:t toc:nil \n:nil @:t ::t |:t ^:t -:t f:t *:t <:t author:nil
  :EXPORT_OPTIONS: TeX:t LaTeX:t skip:nil d:nil todo:t pri:nil tags:not-in-toc
  :EXPORT_DATE: 2019-07-02 清华
  :EXPORT_BEAMER_HEADER+: \author{续本达}
  :EXPORT_BEAMER_HEADER+: \institute[清华工物]{清华大学 工程物理系}
  :EXPORT_BEAMER_THEME: Boadilla
  :EXPORT_BEAMER_COLOR_THEME: crane
  :EXPORT_BEAMER_FONT_THEME: professionalfonts
  :END:
** 概论复习
   四个原则： _复现_ _透明_ _一次_ _最佳工具_

** 命令环境
   - 基本的命令
     - ls :: list structure, 列出当前路径中的文件
     - cd :: change directory, 改变当前路径
     - sudo :: 使用最高权限执行操作
     - apt :: Advanced Package Tool 软件管理器
     - apt-get :: 软件管理下载器，与 apt 功能基本一致
     - vim :: 文本编辑器
     - nano :: 文件编辑器
   - 每个命令都完成一件确定的事

     Do one thing, do it right.

   - 命令的组合有无限可能

     作者无法预计用户如何使用他的工具

     - 组合的可能性太多，入门比较难
     - 一旦入门威力巨大

** 命令环境自学教程
   - 苏勇, [[https://study.163.com/course/courseLearn.htm?courseId=232007][Linux 入门基础 - 网易云课堂]]
      
     通过 GNU/Linux 讲授 POSIX 环境基础。内容稍旧，思想不变。
   
** 文本编辑器
   [[./fig/gedit.png]]

** 文本编辑器(复古)
   [[./fig/nano.png]]

   - 没有菜单，只有快捷键
** Git 三种状态
   - 已提交（committed） :: 改动安全保存在数据库中
   - 已修改（modified） :: 自上一次提交，有文件被修改
   - 已暂存（staged） :: 已修改的文件被作了标记，将被包含在下一轮提交中

      [[./fig/git-modes.png]]              
** Git 同步
   #+Attr_LaTeX: :height 0.7\textheight
   [[./fig/git-distributed.png]]

   - 通过 SSH (secure shell) 通信。

** 练习（不记分）：查看备课历史

   - https://github.com/heroxbd/physics-data

     #+BEGIN_SRC bash
git clone git@github.com:heroxbd/physics-data.git
git log -p
     #+END_SRC

** 内容较多未成体系
   - 犹如造房子的准备材料阶段。
   - 马上会用到的，逻辑：
     - Github 是知名的协作平台，越来越多科研成果在 Github 或类似平台上发布
     - 交作业需要使用 Github，在作业中体会日常工作流程
     - Git 的客户端中，只有命令行是最可靠的。
     - Git 命令运行依赖于 POSIX 环境。
     - 大家一起安装配置了 POSIX 环境。
     - 在 POSIX 环境需要进行文本编辑，用到了 =nano= 。

       WSL，MacOS，GNU/Linux，远程 SSH 账户
   - 一般工作中， =nano= 常用作应急编辑器，有更高级的编辑器可用。
     - VSCode
     - Emacs
     - Vim
     - 其它

** 同学的一些反馈
*** 老师操作太快，自学效率高
    - 自己弄一遍好像也没有很难。希望老师操作的时候慢一点，讲讲每一步是做
      什么，其它部分可以快一点。

    - 感觉后面的演示有点快
*** 与之前的课程差距很大                                     :B_exampleblock:
    :PROPERTIES:
    :BEAMER_env: exampleblock
    :END:
    课堂纪律有些乱，课程内容与之前学习的程设课程差别较大。
*** 需要更多的帮助
    感觉老师高估了大家对计算机的熟悉程度，好多同学只会使用图形化界面，
    不习惯命令行界面，需要保姆式教学，熟悉命令行这一部分应该尽可能详细
    且留充足的时间，安排足够的助教轮次帮助同学绕开大坑。

** 我的经历 2002年
   《工具的狂热——我的 Linux 历程》
*** 安装系统   
    安装画面相当帅，但帅过之后我发现自己完完全全不熟悉这东西，而且那界
    面的中文还不知道所云，调成英文我又不大认识（当时痛下决心一定学好英
    语）。---- 就这样，装了一遍两遍三遍，万物遍，从中午搞到晚上，一个
    问题一个问题在克服，最后终于每次安装失败都稳定在同一个错误上，抱着
    英汉词典查出来那个很长很长的提示好像是在说第三张盘的某某包安装错误。
*** 不知道 Password                                          :B_exampleblock:
    :PROPERTIES:
    :BEAMER_env: exampleblock
    :END:
    这一玩我傻了，什么 login: 啊，什么 password: 啊，我什么都不知道的
    咧（事后诸葛亮，安装不完全只要 root 不需要密码就能进的）。已经半夜
    了，我撅在床上这个憋屈啊，搞了大半天连个系统是啥样的都不知道，被一
    个 password 直接挡了回来。
** 我的经历 2003年
*** 过了一年还是不知道 Password
    但试机的时候我就木了，同样一个黑乎乎的屏幕上输 "Login:"和
    "Password:" 之后就是一圈怪怪的提示符，我把记得的 DOS 命令全部试了
    一遍，发现只有 "dir"和"cd" 可以用，就一个目录一个目录地探索起来。
    这时我前排的一个抖腿男已经是手抚键盘上下翻飞了，那屏幕蒺藜咕噜地翻
    了一页又一页，花花绿绿的不知道什么东西。我再一斜眼，左前方的小姑娘
    已经开了一个蓝蓝的 Pascal 界面正在写测试程序呢，我这才想到重要是得
    知道 pascal 在哪啊，不好意思地问了旁边的队友，才在 Free Pascal 上
    一点点搞起来，真别扭，一点状态都没有。队友大师兄指点我几下就去帮别
    人了，良久回来嫩嫩地说“我帮小妹妹调好了一个程序，小妹妹说我是牛人”。
    听得我更没心情编程了，就又 "cd" "dir" 地胡乱扯了起来。不一会儿大师
    兄开始玩 /usr/games/banner ，我也跟着弄了几下，心里飘飘忽忽一点底
    都没有。

*** URL                                                     :B_ignoreheading:
    :PROPERTIES:
    :BEAMER_env: ignoreheading
    :END:

    http://jkparadise.space/home.php?mod=space&uid=13&do=blog&id=196    
** 今日新闻 G20
   #+Attr_LaTeX: :height 0.5\textheight
   [[./fig/news-G20-2019.jpg]]

   - 国家主席习近平6月29日同美国总统特朗普在大阪举行会晤，就当前中美经贸
     摩擦以及共同关心的国际和地区问题深入交换意见……

   - 特朗普政府的政策对中美关系产生深远影响。同时，2016年美国大选中的
     一次重要转折，对特朗普的竞选影响极大。
** 邮件数据集
   - 很多往来邮件
     https://cloud.tsinghua.edu.cn/d/f8ad70a64cc6462a89fd/
   - 邮件的结构 实例展示
* 第二周第三天
  :PROPERTIES:
  :EXPORT_FILE_NAME: w2-3
  :EXPORT_BEAMER_HEADER+: \title{实验物理的大数据方法}
  :EXPORT_OPTIONS: H:1 num:t toc:nil \n:nil @:t ::t |:t ^:t -:t f:t *:t <:t author:nil
  :EXPORT_OPTIONS: TeX:t LaTeX:t skip:nil d:nil todo:t pri:nil tags:not-in-toc
  :EXPORT_DATE: 2019-07-10 清华
  :EXPORT_BEAMER_HEADER+: \author{续本达}
  :EXPORT_BEAMER_HEADER+: \institute[清华工物]{清华大学 工程物理系}
  :EXPORT_BEAMER_THEME: Boadilla
  :EXPORT_BEAMER_COLOR_THEME: crane
  :EXPORT_BEAMER_FONT_THEME: professionalfonts
  :END:
** 柏拉图世界观
   [[./fig/SCI.png]]

   - 数学世界独立存在，由它推演出物理世界
** 实验物理
   #+Attr_LaTeX: :height 0.6\textheight
   [[./fig/SCI.png]]
   - 实验仪器是从物理世界到人类的一条信息通道
     - 实验仪器的分辨率有限，我们在进行有损通信
   
** 举个例子
   [[./fig/reconstruction.png]]
   - 建立模型解释物理世界发生的现象，通过统计方法反推本质。
** 大作业安排
   - 2019.7.11 - 2019.7.26
     - 模拟实验测量
     - 包含只选《实验物理的大数据方法（1）》前两周课同学的队伍截止到 2019.8.4
       
   - 2019.7.22 - 2019.8.11
     - 分析实验测量
*** 上课时间变动 :B_alertblock:
    :PROPERTIES:
    :BEAMER_env: alertblock
    :END:
    - 2019.7.17 停上，在 6A207 答疑，改到 2019.7.19 上课。
      - 物理系同学搬宿舍
** 实验测量的模拟
   - 输入 :: 物理对象的信息，随机因素的概率分布
   - 输出 :: 多阶段，最终输出为模拟的实验测量原始数据
   - 采分 :: 各阶段的实现，最终输出的正确性，作业报告
** TOLA 射电干涉的模拟
   #+BEGIN_SRC dot :file ./TOLA-pipeline.pdf :cmdline -Kdot -Tpdf
     digraph dataset {
     bgcolor="#ffffff00"

     S [label = "i (1..N) 射电源的\n 方向、频率、振幅", shape=box]
     B [label = "j (1..M) 基站\n 位置", shape=box]
     P [label = "i 射电源在基准 1 号基站\n诱导的信号"]
     Q [label = "j 基站上\n接收的总信号"]

     S -> P
     B -> P
     P -> Q[label="线性相加\n时间平移"]

     O [label = "时钟偏移的\n高斯分布标准差", shape=box]
     F [label = "j 基站的时钟偏移", shape=box]
     O -> F [label = "抽样"]
     F -> Q
     }
   #+END_SRC

   #+Attr_LaTeX: :height 0.7\textheight
   #+RESULTS:
   [[file:./TOLA-pipeline.pdf]]
   
** 二维金属等能面测量的模拟

   #+BEGIN_SRC dot :file ./isoenergy-pipeline.pdf :cmdline -Kdot -Tpdf
     digraph dataset {
     bgcolor="#ffffff00"

     H [label = "二维金属的等能面\n态密度"]
     R [label = "普通散射中心在原点时的\n实空间态密度"]
     H -> R [label = "动量序对积分"]

     RD [label = "普通散射中心\n扫描电子显微镜图像"]
     R -> RD [label = "衰减"]

     M [label = "磁性散射中心在原点时的\n实空间态密度"]
     H -> M [label = "动量序对积分\n且带额外相位"]

     M -> MD [label = "衰减"]
     MD [label = "磁性散射中心\n扫描电子显微镜图像"]
     }
   #+END_SRC

   #+Attr_LaTeX: :height 0.7\textheight
   #+RESULTS:
   [[file:./isoenergy-pipeline.pdf]]
** 二维金属等能面测量的模拟 例子
   #+Attr_LaTeX: :width 0.45\textwidth :center
   [[./fig/scatter-momentum.png]]
   #+Attr_LaTeX: :width 0.45\textwidth :center
   [[./fig/scatter-real.png]]
** 中微子实验光电子读出的模拟
   #+BEGIN_SRC dot :file ./PMT-pipeline.pdf :cmdline -Kdot -Tpdf
     digraph dataset {
     bgcolor="#ffffff00"

     S [label = "光电子到达时间\n振幅、采样通道"]
     T [label = "单光电子响应\n时间曲线"]

     G [label = "光电子总信号"]
     S -> G
     T -> G

     N [label = "白噪声幅度", shape=box]
     W [label = "白噪声"]
     N -> W[label = "抽样"]

     G -> D [label = "相加"]
     W -> D
     
     D [label = "探测器数据"]
     }
   #+END_SRC

   #+Attr_LaTeX: :height 0.7\textheight
   #+RESULTS:
   [[file:./PMT-pipeline.pdf]]
** 分组
   - 同学们先联络好，具体操作在 Github Classroom 上进行
   - 每队至多三人

* 第三周第三天
  :PROPERTIES:
  :EXPORT_FILE_NAME: w3-3
  :EXPORT_BEAMER_HEADER+: \title{GNU Make 的数据生产线}
  :EXPORT_OPTIONS: H:1 num:t toc:nil \n:nil @:t ::t |:t ^:t -:t f:t *:t <:t author:nil
  :EXPORT_OPTIONS: TeX:t LaTeX:t skip:nil d:nil todo:t pri:nil tags:not-in-toc
  :EXPORT_DATE: 2019-07-18 清华
  :EXPORT_BEAMER_HEADER+: \author{续本达}
  :EXPORT_BEAMER_HEADER+: \institute[清华工物]{清华大学 工程物理系}
  :EXPORT_BEAMER_THEME: Boadilla
  :EXPORT_BEAMER_COLOR_THEME: crane
  :EXPORT_BEAMER_FONT_THEME: professionalfonts
  :END:
** 复习：命令行的函数调用
   #+BEGIN_SRC sh
func a1 a2
a1 : $1; a2 : $2
   #+END_SRC

   - 变量 =$a= ，或 =${a}=
     - 防止歧义 =${a}b= 与 =$ab=

** 复习：程序返回值
   - 返回 0 代表成功
   - 返回非 0 代表有错误，不用的值可以代表不同的错误
   - 可以由此实现条件结构和 =while= 循环
     #+BEGIN_SRC sh
       while [ -d $dir ]; do ...; done
     #+END_SRC

     #+BEGIN_SRC sh
       if command; then ...; fi
     #+END_SRC

** 复习：循环
   - =while= 和 =for= 循环

   #+BEGIN_SRC sh
     for fruit in apple pear lemon; do
         echo "我吃 ${fruit}"
     done
   #+END_SRC
** 复习：POSIX 基本权限
   - rwx: read, write, execute
   - 421: 0b100, 0b10, 0b1
   - uga: user, group, all

#+BEGIN_SRC sh
  chmod a+w '<directory>'
#+END_SRC

** 复习：命令行进程控制
   - Ctrl-C 终止
   - Ctrl-Z 挂起
     - =bg= 到背景进程
     - =fg= 到前端进程
     - =sleep 100 &=
     - =jobs= 查看进程
     - =kill %3= 终止第3个进程

** 正则表达式
   - 基本的形式语言，强大地匹配字符串
     - 理论计算机视角：匹配的字符串是可以被正则表达式定义的自动机接受的输入
     - 用户可以只关注形式语言的使用
     - 开发者可以只专注于形式语言的引擎
   - 由基本定义演化出无穷种的用法
     - _最佳工具_ 的一个特征
   - =grep= , =sed=

** 补充 =find=
   - 用来查找文件
     - 目录是一种特殊的文件
   #+BEGIN_SRC sh
     find .
     find . -name "*.sh"
     find . -type d
     find . -name "*bin" -and -type f
   #+END_SRC

** 补充：文件批量重命名
   - 切换至 =Shell-Scripts.slides.html=
   
** 彩蛋： =cowsay= =sl=
   #+BEGIN_SRC sh
     apt install cowsay-off sl
     cowsay "Am I cute?"
   #+END_SRC

*** 彩蛋: bb
    - 安装 =bb= ，执行

** 其它工具与练习：mutt
   #+BEGIN_SRC sh
     apt install mutt
     mutt -f xxxx.mbox
   #+END_SRC

** 命令行学习的几点建议
   - 耐心：学习一件新事物，需要一定时间适应
   - 创新：创新地组织工具，尝试使用命令替代程序
   - 实用：具体问题具体分析，选择 _最佳工具_
*** 最佳工具
    - 正则表达式
    - 并行计算，高性能计算

** 批量处理海量数据
*** 命令行探索之后，要将数据处理方法自动化
    - 调用很多命令和程序
    - 写很多自定义的脚本
    - 处理很多数据，有很多中间结果
      - 中间结果的间的依赖关系可以很复杂
    - 程序有更新怎么办？数据有更新怎么办？
*** _复现_ 原则的要求 :B_exampleblock:
    :PROPERTIES:
    :BEAMER_env: exampleblock
    :END:
    要记录下来以什么样的顺序和参数运行什么命令，执行什么程序。

** 数据流水线的构造目标
   - 把流程系统化成输入、输出与过程三要素。
     - 而向数据编程，data-driven programming
   - 系统表达输入数据、输出数据和中间结果的依赖关系。
   - 高效执行，包括并行处理和整合超级计算机等。
   - 错误恢复
     - 修正错误后，可以从最后一步正确的数据开始继续执行。

** Make
   - =make= 工具已经有 40 多年的历史，最初是用来管理 C 语言程序的编译。
     - 根据依赖关系决定命令执行顺序
     - 正好满足我们的所有需求
   - =GNU make= 是 =GNU= 运动中，对 =make= 进行的招展，更加适合管理数据
     - =GNU= : =GNU is Not Unix=
*** 作用
    1. 实现 _复现_ 原则
    2. 管理程序运行，在超级计算机上运行
    3. 从错误中恢复
** Makefile
   - 基本语法
     #+BEGIN_SRC makefile -i
target: source
	program source target #如何做
     #+END_SRC

** 变量
   - 变量取值
     #+BEGIN_SRC makefile -i
a:=1
$(info $(a))
     #+END_SRC

     - 调用时使用 =$( )=
   - _一次_ 原则，避免重复
     #+BEGIN_SRC makefile -i
target: source
	program source target #如何做
	program $^ $@ #如何做
     #+END_SRC
** 调用命令
     #+BEGIN_SRC makefile -i
a:=$(shell seq -w 0 9)
     #+END_SRC
   
** 一般匹配关系 pattern
     #+BEGIN_SRC makefile -i
%.png: %.h5
	xxxxx
     #+END_SRC

** 特殊目标
   - =.PHONY= 代表无对应文件的目标
   - =.DELETE_ON_ERROR= 如果出错就把坏文件删掉
   - =.SECONDARY= 保留中间结果
     
     #+BEGIN_SRC makefile -i
.PHONY: all
all: xxxx

# Delete partial files when the processes are killed.
.DELETE_ON_ERROR:
# Keep intermediate files around
.SECONDARY:
     #+END_SRC

* 第三周第四天
  :PROPERTIES:
  :EXPORT_FILE_NAME: w3-4
  :EXPORT_BEAMER_HEADER+: \title{课堂综合练习：Python, Git, Shell, Make}
  :EXPORT_OPTIONS: H:1 num:t toc:nil \n:nil @:t ::t |:t ^:t -:t f:t *:t <:t author:nil
  :EXPORT_OPTIONS: TeX:t LaTeX:t skip:nil d:nil todo:t pri:nil tags:not-in-toc
  :EXPORT_DATE: 2019-07-19 清华
  :EXPORT_BEAMER_HEADER+: \author{续本达}
  :EXPORT_BEAMER_HEADER+: \institute[清华工物]{清华大学 工程物理系}
  :EXPORT_BEAMER_THEME: Boadilla
  :EXPORT_BEAMER_COLOR_THEME: crane
  :EXPORT_BEAMER_FONT_THEME: professionalfonts
  :END:
** 回顾
*** 科学数据处理的原则 :B_alertblock:
    :PROPERTIES:
    :BEAMER_env: alertblock
    :END:
    _复现_ _透明_ _一次_ _最佳工具_

*** 版本控制
    Git 与队友分工协作，与明天的自己协作

*** 数据流水线
    GNU Make 管理数据的依赖与转换，实现错误恢复和并行计算

*** 命令环境
    POSIX 环境中强大的小工具组合，开发与使用相融合

*** 计算语言
    Python 语法友好，工具丰富，统领 C/C++/Fortran 库
** 引力波探索回顾
   - 人类正在全球建设引力波观测网络：美国 LIGO，欧洲 Virgo，日本 KAGRA
     - 更好地定位引力波信号源
   - 开放科学：LIGO 公开了引力波观测的关键数据。 _复现_ 的典范
     - 开放数据经简化之后用于教学，[[https://www.gw-openscience.org/s/events/GW150914/LOSC_Event_tutorial_GW150914.html][传送门]]
     - ...因此有了 UC Berkeley 的 /Data science and Bayesian statistics for physical sciences/ 课程大作业
       [[https://phy151-ucb.github.io/seljak-phy151-fall-2018][传送门]]
     - ...因此有了这节课
   - 我们借助 LIGO 的数组进行了科学数据可视化的初步。随手画图，
     - _复现_ 性较差
     - 数据如果有变化程序也要修改，容易违背 _一次_ 原则
** 综合
   #+attr_beamer: :overlay <+->
   1. 整理 LIGO 原数据，放在 =data/= ，加入 =.gitignore=
   2. 把 =readligo.py= 加入 Git 管理
   3. 建立 Makefile，写入画图过程
   4. 进行 Fourier 变换，画出频谱
   5. 算出振幅密度，画图
   6. 读取广义相对论预言的波形，画图
   7. 算出信噪比相对强度谱，画图
   8. 对相对谱进行滤波，找到信号
   9. 通过 =specgram= 寻找信号，作图
* 第四周第一天
  :PROPERTIES:
  :EXPORT_FILE_NAME: w4-1
  :EXPORT_BEAMER_HEADER+: \title{关系代数}
  :EXPORT_OPTIONS: H:1 num:t toc:nil \n:nil @:t ::t |:t ^:t -:t f:t *:t <:t author:nil
  :EXPORT_OPTIONS: TeX:t LaTeX:t skip:nil d:nil todo:t pri:nil tags:not-in-toc
  :EXPORT_DATE: 2019-07-19 清华
  :EXPORT_BEAMER_HEADER+: \author{续本达}
  :EXPORT_BEAMER_HEADER+: \institute[清华工物]{清华大学 工程物理系}
  :EXPORT_BEAMER_THEME: Boadilla
  :EXPORT_BEAMER_COLOR_THEME: seahorse
  :EXPORT_BEAMER_FONT_THEME: professionalfonts
  :END:
** Git 的 Remote 与 Merge

** Makefile 的高级应用示范

** 科学范式的演化
   #+attr_beamer: :overlay <+->
   - 经验时代：占星术等等
   - 理论时代(17世纪起)：牛顿力学，微积分，麦克思韦方程，相对论等等
   - 计算时代(20世纪中)
     - 理论一般由程序描述，大规模数值模拟成为可能
     - 计算物理、计算化学等等
   - 数据时代(21世纪初)
     - 从数据中直接总结经验模型，与理论模型同等重要
     - 虚拟天文台等等
** 数据时代的要素
   - 存储空间
     - 存储介质物美价廉：小于 1GB/元
   - 计算能力
     - 每 18 个月翻一倍
   - 传感器
     - 取数能力大大增强

*** 数据本身具有价值
    数据在被采集之外的目的中发挥作用
    
    - 通过人们对感冒症关的探索预测流感爆发
    - 黑洞吸积盘“照片”，多个射电望远镜联合交换数据组成相干阵列

** 工商业与科学的融合
   - 工商业的决策开始基于数据
     - 市场调查，AB 测试，用户隐私数据收集
     - 分析消费习惯，预测需求，进行定价
     - 制定生产、物流、仓储策略
   - 金融交易：基于历史数据建立模型，半自动或全自动交易

** 知识储备与技能组合
   #+Attr_LaTeX: :height 0.65\textheight
   [[./fig/Data_Science_VD.png]]

   - 数据时代需要专业知识、数理统计和黑客技术等多方面技能
   - 本课程讲的都是黑客技术，没有讲统计方法？ \to 其它课程

** 数据的存储格式
   
   - CSV :: 文本表格
   - JSON :: 文本字典结构
   - HDF5 :: 二进制树状结构组织的表格

   - 有没有一种抽象的数据表示，把引擎与应用分离？
     - 关系代数：一切都是关系，关系都是表格

** Numpy Structured Array
   - 复合型 =dtype=
     
     #+BEGIN_SRC python
       import numpy as np
       np.zeros(3, dtype=[("i", np.int), ("v", np.float), ("w", np.int, 3)])
     #+END_SRC

   - =PE-info.h5=

** Structured Array 基本操作
   - indexing 取数
   - 取列

** Pandas
   - Python 中处理表格类数据的工具

     =apt install python3-pandas=

   - indexing 取数
   - 取列
   - 连接
     - 左，右
   - 笛卡尔积
   - 集合运算
   
** 关系代数
   #+attr_beamer: :overlay <+->
   - 关系：${(r, s)|r \in R, s \in S}$
   - 关系代数：在集合基础上定义关系运算的封闭系统
     - 封闭系统：运算作用于一个或多个关系上来生成一个关系

   - 围绕关系代数设计的关系数据库是存储海量数据的标准
     - 代表：Structure Query Language (SQL) 语言
   - 关系代数的思想具有一般性：
     - 管理数据
     - 添加数据
     - 分析数据

** 基本动机
   - 关系代数设计师 Todd，图灵奖工作
   - 数据都应该自我描述
     - 即使数据的存储形式变了，对程序进行操作的程序也不应该改变
     - 反例：链表
     - 反倒：随意写成的 Excel 表格
   - 方便扩展到大规模的数据库中

*** 实用价值
   - 引擎优化与应用分工
   - 引擎：自动 out-of-core computing (超出内存的运算)
   - 引擎：自动并行计算

** 直观理解：一切都是表格

   | Event | Channel | Time | Weight |
   |-------+---------+------+--------|
   |     0 |       0 |    1 |    1.1 |
   |     0 |       0 |  1.1 |   1.15 |
   |     0 |       2 |  1.2 |    1.3 |
   |     1 |       3 |  0.8 |    0.9 |

   | Event | Channel | Wave          |
   |-------+---------+---------------|
   |     0 |       0 | [0,0.1,...,0] |
   |     0 |       2 | [0,0.2,...,0] |
   

** 关系代数的基本运算
   - 集合运算：交、并、差
   - 连接(Join)
   - 投影(Projection)
   - 笛卡积(Product)
   - 分类运算(Groupby)
* 第四周第四天
  :PROPERTIES:
  :EXPORT_FILE_NAME: w4-4
  :EXPORT_BEAMER_HEADER+: \title{实验物理的大数据方法：面向未来}
  :EXPORT_OPTIONS: H:1 num:t toc:nil \n:nil @:t ::t |:t ^:t -:t f:t *:t <:t author:nil
  :EXPORT_OPTIONS: TeX:t LaTeX:t skip:nil d:nil todo:t pri:nil tags:not-in-toc
  :EXPORT_DATE: 2019-07-25 清华
  :EXPORT_BEAMER_HEADER+: \author{续本达}
  :EXPORT_BEAMER_HEADER+: \institute[清华工物]{清华大学 工程物理系}
  :EXPORT_BEAMER_THEME: Boadilla
  :EXPORT_BEAMER_COLOR_THEME: seahorse
  :EXPORT_BEAMER_FONT_THEME: professionalfonts
  :END:
** 大作业网站
   https://data-contest.net9.org/
** 大作业：金属等能面
   - 郝镇齐时间
** 大作业：TOLA 射电干涉源
** Python 驱动 C++ 程序
   - 很多“严肃”程序由 C++ 写成，可以使用 Python 将其变换成 REPL
     - 非常方便探索
     - pyROOT
     - Geant4-python
     - Boost-python

** 技能集合
   #+Attr_LaTeX: :height 0.65\textheight
   [[./fig/Data_Science_VD.png]]

   - 数据时代需要 *专业知识* 、 *数理统计* 和 *黑客技术* 等多方面技能。
** 黑客技能
*** 科学数据处理的原则 :B_alertblock:
    :PROPERTIES:
    :BEAMER_env: alertblock
    :END:
    黑客的审美： _复现_ _透明_ _一次_ _最佳工具_

*** 版本控制
    Git 与队友分工协作，与明天的自己协作

    Git 是“搬砖工地安全帽”，无头盔禁止上岗

*** 关系代数
    数据表示成关系，数据的操作表示成关系代数运算

*** 数据流水线
    GNU Make 管理数据的依赖与转换，实现错误恢复和并行计算

** 黑客技能（二）

*** 正则表达式

*** 命令环境
    POSIX 环境中强大的小工具组合，开发与使用相融合

*** 多语言融合

*** 计算语言
    Python 语法友好，工具丰富，统领 C/C++/Fortran/R/SQL 库

** 技术问题：提问的智慧
   - 关键：如何让他人以最小的努力复现出你的问题
   - http://www.catb.org/~esr/faqs/smart-questions.html

   - Stupid:

     救命! 我的程序又写不了！

   - Smart:

     我的 VSCode 的启动时会卡住，随后崩溃。

   - Smarter:

     我的 VSCode 的启动时会卡住，随后崩溃。错误信息是"xxx,yyy"。我已经
     尝试过 aaa,bbb，但是错误信息变成了 ggg,hhh，依旧会崩溃。

** 计算历史：大型机
   [[./fig/main-frame.jpg]]
   
   - 一台大型计算机，用户通过终端 (Terminal) 连接
** 计算历史：个人计算机
   - 1981年

   [[./fig/ibm-pc.jpg]]
** 计算历史：个人计算机组成集群
   - 1990s 个人计算机组成集群 "beowulf"

     #+Attr_LaTeX: :height 0.65\textheight
     [[./fig/computer-cluster.jpg]]
     
** 高性能计算与超级计算机
   [[./fig/supercomputer.jpg]]

   - 更大的计算机集群，优化节点间的通信，共享存储。
** 虚拟机与云计算
   - 虚拟机：软件模拟计算机
   - 云计算：开放平台，自动生成虚拟机

** 技术问题：TUNA 技术群聊天室
   - TUNA 主页 

     https://tuna.moe/

   - TUNA 技术群，黑客（广义）技术问题探讨

** MapReduce 与函数式编程
   + 错误恢复
   + 基本思想
     - 一切都是函数

** 信号处理 (以其昏昏使人昭昭)
   - 各系开设的《信号与系统》

** 统计学习与机器学习
   - 数学基础

** 大数据、深度学习与人工智能
   - 黑客技术基础，为统计学习与机器学习提供了基本环境
   - 有许多优秀的公开课程

** 大作业的深入研究：中微子
   - 明天上午10点 清华大学刘卿楼 105
   - John Learned 教授将给我们带来 The Saga of Atmospheric Neutrinos
     报告。

   - Learned 教授从1970年代开始活跃在中微子和宇宙线实验领域，是水(冰)下
     和地下中微子实验领域的先驱者。他的科学思想和技术路线对世界上的中微
     子探测器都产生了深远的影响。

     http://hep.tsinghua.edu.cn/~orv/
** 教学团队
   - 教师 :: 续本达
   - 助教 :: 陈嘉杰、张爱强、陈晟祺、高一川、刘晓义
   - 顾问 :: 阮东、郝镇齐、张宗煜、付祈安、唐如麟
   - 小助教 :: 张翔宇、王宇逸、武益阳、邓旭、丁思勤、李岸峰

* 总结
** 缘起基科二十年
   我是基科2005级的学生，当年大二小学期的课程是 Windows MFC C++ 编程。上课时我没有太理解培养计划中的用意，直到2009年我毕业时才从阮老师那里了解到，设置计算机类课程是为了加强同学们在物理研究中使用计算机的能力。后来我一直和科协的学弟保持有联系，听到了科协的一些技术大牛对大二小学期的看法和希望。当时朦胧觉得或许有朝一日我可以假期回学校开个学习小组，带着大家学习一点数据分析的新技术。

   时间快进到2018年的基科二十年庆祝纪念活动和学术交流会。一次和阮老师在王刚的办公室里闲聊，正好说到暑假小学期。阮老师说从十多年的毕业生座谈中，许多同学希望能在计算机课程和物理课程之间，加一门课帮助大家把两者连系起来。我说是啊，从我跟师弟师妹们的交流来看，大家在把编程技能迁移到物理研究实践中时普遍遇到很多困难。实际上同学开研究时，要么是自己摸索，要么是接受学长指导，一不留神会掉坑，或者在赶时间的过程中图省事养成一些不良习惯。阮老师说确实很苦恼，原来是 Windows 下的 C++，后面我发现物理研究中使用 Linux 系统很多，就在培养方案中换成了 Linux 下的 C++。可是计算机系的老师会从自身的学科要求出发，不会照顾物理系同学，物理系的老师又比较难支撑整个计算机类课程。我抚掌道，我本科时代不务正业，在科协玩了不少计算机类的奇怪东西，神奇的是，它们现在正好都对应着商界工业界造出的云计算、大数据的概念，而且我在粒子物理实验中，恰好把这些曾经歪门斜道的屠龙之技发挥到了极致，如果有大二同学想做实验物理，我倒是一直有组织一个讨论班的想法。阮老师笑道，对啊，你赶快入职吧，今年暑假马上就开一门课。

   我打了个机灵，锅从天降，任重而道远啊。我说既然如此，我愿意试试，只是现在开始准备估计很难来得及啊。好在后来阮老师联系了教务询问开课事宜，得知最早开课也是2019年的暑假。我才长出了一口气，不然自己肯定上课挂白菜了。

   这事我越想越美，越想越激动，就直接写了一个课程大纲推到了 [[https://github.com/heroxbd/physics-data/blob/master/pd.org][Github 上]] 。我为何如此振奋呢？仔细想来大约有四点最最主要的：

   其一，这个课程的内容，代表我作为一名以物理为主业的人，十几年前探索出来的一条计算机技术的整体方案。我也没有在物理系的培养方案中得到如何用编程帮助我做研究，为了寻找好的方法，我甚至在本科阶段花的精力超过了我学习物理。而和我一起研究这些技能的系科协学弟们都发现自己更热爱计算机，转行做CS研究或（年薪百万的）程序员，只有我还在留在物理界抱着自行研发的技术自娱自乐。我也曾经试着给同课题组的同学们介绍一些当代的高级计算机技术，大家都不是很适应，觉得为了工具改变习惯太不值得了。因此最终我还是一名独行者，我早年一直在怀疑自己探索这些是否值得，直到最近才坦然了：管它有用没用，我高兴就好，没用就当作业余爱好嘛。把这些技能教给我的学弟学妹，让我感到特殊亢奋。大二的同学们正好没有既有程序风格惯性，更乐于接受新技术。我自己也可以从同学的反馈中验证十年前来一直让我感到人格分裂的难题：我在物理研究中所玩的，看似很专业实际三脚猫的计算机技能，到底是独门绝技还是自娱自乐，全靠我的学弟学妹们是否授受来评判了。

   其二，这件事情是受阮老师的委托，受已经系友的委托。我应当仁不让，把担子挑起来，不论如何也应把同学们的在物理和计算机之间建一架桥，削除数物大类学生对计算机的神秘感和畏惧，溶解“我只对物理感兴趣，不学别的”和“学计算机？不就是修电脑吗？”的物理系式误区。

   其三，我正在组建中微子实验的研究团队，工物系的同学有很多了解的渠道，我也希望能吸引到物理系的同学。本来在清华中微子物理这样的基础物理学研究在工物系就是历史的遗留，我希望我的研究能被物理系的同学了解。一门以大规模实验数据分析为线的课程，正好代表了我研究工作的日常，对大二同学进入实验室之前，肯定会发挥非常切实的体验作用。想到今后在我的组里，会有工物系和物理系的同学一起研究讨论，大家大类分流之后再聚到一起，也是非常令人激动的。

   其四，一门四学分的小学期课，实在是太适合我了！作为教研系列青年教师，每年的教学任务是64学时，即4学分。以一个月的奋斗，换取一年自由身，学期中开会访学都不会受到上课的限制，还有余力帮助同事代课，简直无法想象有比这个更美好的事情了。目前青椒的考核重点还是科研，但是科学的工作量必须与科研相等，这对刚起步的教师有非常大的压力。部分院系给出了入职几年以内允许不达到教学工作量的优惠政策，正好从侧面反映了这个事实。真是要感谢阮老师的提议，让我一下子进入非常稳定的教学状态和格局。

   这四点，任何一点单独拿出来，都足够我欢喜雀跃地去达成，何况有四点！所以我高兴得一下子就把课程大纲想出来了，之后很快就落实在书面上。

** 开课路漫漫
   实际开课的过程还是很扣人心弦的，大概有5个时间点。

   第一个节点让恢复理性。我很兴趣地把开课计划和陈老师讲了。陈老师比较担心课程缺乏特色，因为工物系已经有粒子物理的数据分析研究生课程了。我说可以把重心放在当代计算机科学技术发展的新工具上，陈老师表达了我并非科班出身，是否能讲得专业的顾虑。这让我心里的热锅冷静了下来，仔细思考我的课除了满足我的需求和院系培养方案的需要之外，会给同学带来什么。于是在多方征求意见的同时，我自己也和自己进行了一场旷日持久的大辩论：到底有开课的必要吗，我开计算机为主的课是不是不务正业？
   
   第二个时间点上，我被注入了一轮兴奋剂。11月我十分不务正业地与冬波、振齐、欣彤和卓卓组队打了一场计算机系组织的论文作者去重的比赛。本来我是来体验一下竞赛的，以更好地准备之后的 Ghost Hunter 中微子数据分析排位赛。比赛准备时，欣彤提出了数据格式的规定，我按照这个规定使用 `Makefile` 把整个复杂的处理流程都串了起来。本来我心里没底，比较担心大家是否能接受 `Makefile` 这样鬼畜的上古语法，没想到大家非常开心地使用了。这让我无比振奋！因为我们虽然号称是基科战队，但是完全是五种人类。嘛，这也从侧面反映了基科的多元性。我是物理系大凝聚态传统下的另类，再加上对计算机的洁癖，代表小众的物理审美。冬波是去文科世界使用数据进行跨界打劫的理科学者，他用严谨的数学和物理思维对不确定的世界进行建模讲故事，自成一派为数据工程学，这次竞赛正是他的主场。振齐代表物理系的主流，既有强大的直觉又有深刻的思想，做实验一丝不苟，使用计算机模式是对师兄的（祖传）代码进行改进，渴望学习新技术但为精力所限。欣彤在机器学习和大数据领域研究，代表当代数据处理的尖端，建模、拟合、调参更如入无人之境，已有成熟的数据处理流水线。卓卓代表应用数学和统计学习，进入所有学科的后花园，对一切新事物具有如饥似渴的学习热情。这样一个采样，基本上覆盖了物理系的同学的所有可能的形态，样本甚至覆盖了团委、学生会和科协，大家竟然一致认为 Git 加 Makefile 的工作流程太科学太强大太神奇了。我对工物系的同学并不担心对我未来的课的接受程度，工物系的同学已经有有学习工具软件的课程，反而物理系的同学的偏好我其实心里没底。可见这一经历对我的触动有多么深刻和强大，它一下子消解了我对开课意义本身的怀疑。

   于是我又行动起来，把几个月前写的大纲放在了饥渴乐园征求意见。大家很开心，七嘴八舌提建议。这期间得到了唐如麟、史冬波、孙慧辰、吕铭、付祈安、魏胜禹、郑鑫宇、陆思锐、王泉、陈思维、代一、鲍亦澄。在大家的热烈讨论中，很多方案和设计都保留在了最后，比如课程名，课程录像，Git/Makefile 主线，Github Classroom，大作业的风格等等。这一稿被拍得最多的是：太难了，给学弟学妹们留条活路吧！还有课程不要变成 Installation party。同学们也奔走相告，大纲被传到各个年级群里，引发了各种争论。我也不断修改着课程的设计，融合集体的智慧。霍师兄也正有此意，正在筹备到大学开天体物理数据类的硬课，我们围绕大纲交换了不少看法。这时，箭已在弦畜势待发，我的担心变成了这门课得能穿越行政审批，按时开课。

   到了新课申请的季节，我先和阮老师讨论了一次。我完善了大纲先没给阮老师看，请阮老师谈对课程的期待。阮老师说，要让同学们在物理研究中熟练使用计算机，为大三开始 seminar 进入科研训练打好基础。我拿出了大纲，教学目标竟然和阮老师说得一模一样！讨论非常顺利，阮老师在物理系教学委员会上提议进行了讨论，课程获得通过，物理系向工物系发出教学任务书。一个反馈是，取名为《实验物理的大数据方法》是否太大，何不按课程内容取名为《Python 数据分析入门》。我的回答是课程专注于讲授当代的计算机技术和工具，此时 Python 最结合进行数据分析，但未来可能被其它更好的语言取代。

   在工物系，我依旧没有把握，因为最近系里所开新课较多，驳回率偏高。陈老师帮我分析了课程设计的回题，指出大家评估的开课必要性时的关键。我对课程在在工物系培养方案中的地位进行了重点阐述，对国内外和其它院系开设的类似课程进行了深入的调研。在教学委员会上，开课受到的质疑在于使用4学分学习软件的必要性：理工科学生，通过阅读文档和说明书，就可以快速上手一件工具，有必要用正式的课程来教学呢？这个质疑一针见血，也是我与自己辩论时的焦点。我举了两个例子讲实际工作中，同学们的数据分析工作，上手很难，缺乏系统性和良好的习惯，浪费时间或者弱化科研结果。我得到了比较多的鼓励，系里的老教授还跟我讲想来听课分析最新物理实验的公开数据。工物系大二小学期已经安排得很满，高老师最终建议了完美的解决方案：把课程分成两部分，各两学分，工物系同学选第一门课，物理系同学选两门课统一给分。

   接下来我在两系教务办公室穿梭了多次，在（小）陈老师和葛老师的帮助下，最终完成了开课手续。
   
